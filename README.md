# VHDL-garland-for-FPGA-T-Core
 VHDL код для ПЛИС T-Core, который использует зелёные и КЗС светодиоды на плате. Предусотрено несколько режимов свечения для РГБ светодиодов

1) Обзор платы
Исходя из информации представленной на официальном сайте (Terasic), в T-Core основным компонентом является ПЛИС MAX 10, а также присутствует различная периферия: 4 Dip-переключателя, 2 кнопки, 4 зелёных и 4 RGB светодиода. На Рис. 9 показано расположение этих компонентов на плате.
![image](https://user-images.githubusercontent.com/45430826/191076192-09ca134e-3ce9-4e11-a30f-e192c32054e7.png)

Рис. 1 - Внешний вид T-Core

Для проверки работоспособности ПЛИС MAX 10 и периферии была разработана прошивка, задействующая перечисленные компоненты. Блочная структура схематично представлена на Рис. 2, а изображение .bdf файла на Рис. 3.

![image](https://user-images.githubusercontent.com/45430826/191076303-fda8e5e7-953d-4906-8186-1a5c4768d56c.png)
Рис. 2 - Схематическоое изображение прошивки

![image](https://user-images.githubusercontent.com/45430826/191076319-19509ff0-dfeb-417d-8b0b-567afea140de.png)
Рис. 3 – Скриншот .bdf файла

Входы схемы:
    1. i_clk – тактовая частота 50МГц, подаваемая со встроенного кварцевого генератора
    2. button_0, button_1 – кнопки
    3. sw[0..3] – Dip-переключатели
Выходы:
    1. green_led[0..3] – зелёные светодиоды
    2. RGB_DIN – вход микросхемы WS2812B, через которую осуществляется управление светодиодами
Блоки:
    1. garland_logic – блок управления зелёными светодиодами
    2. RGB_logic – блок управления логикой работы RGB светодиодов
    3. RGB_LED – блок преобразования пакета данных на входе в последовательный NRZ код, для управления RGB LED
Для всех блоков кнопка 0 отвечает за переход в начальное положение работы.


2) garland_logic
Данный блок отвечает за работу «бегущего вперёд-назад огонька» на зелёных светодиодах. Структурно состоит из следующих частей:
    1. Проверка значения счётчика, отвечающего за переключение светодиодов, переход в соответствующее ему состояние.
    2. Последовательное включение одного из четырёх светодиодов и одновременное отключение других трёх.
    3. Задержка между переключениями светодиодов, необходимая для того, чтобы человеческий глаз мог их видеть.


3) RGB_logic
Данный блок реализует четыре режима работы для цветных светодиодов, которые переключаются нажатием на кнопку 1:
    1. Плавная смена цвета на всех четырёх RGB LED с возможностью отключения каждого из них вручную, путём изменения положения соответствующего переключателя
    2. Постепенное увеличение и уменьшение интенсивности излучения цветных СД со сменой цвета при нулевой яркости
    3. Бегущий огонёк, аналогичный блоку garland_logic
    4. Свечение постоянной интенсивности у всех светодиодов. В зависимости от положения переключателей на плате, меняется цвет соответствующего СД на зелёный или красный
На выход led_data блок отправляет пакет из 96 бит. Отправка происходит, когда сигнал обратной связи блока RGB_LED равен 1.


4) RGB_LED
Управление цветными светодиодами происходит через контроллеры WS2812B, установленные на каждом СД. Схема подключения ПЛИС к WS2812B представлена на Рис. 4.

![image](https://user-images.githubusercontent.com/45430826/191076774-d9cef111-d80d-4b82-98a9-72481ee7a31e.png)
Рис. 4 - Схема подключения ПЛИС и RGB светодиодов

Исходя из информации, представленной в документации к WS281B (world-semi), каждый цвет R/G/B может управляться независимо, и каждый цвет может регулироваться от уровня 0 до 255. Поэтому для каждого цвета необходимо использовать 8-битное управление, а для каждого светодиода - 24-битное управление. 24 бита соответствуют Рис. 5.

![image](https://user-images.githubusercontent.com/45430826/191076968-c6f6a6c3-f927-442c-ba16-38f8e026d806.png)
Рис. 5 - Cтруктура 24-битного пакета данных

Блок RGB_LED реализует преобразование параллельных 96 бит, получаемых на вход I_led_data, в последовательный NRZ код. На период обработки полученных данных, сигнал обратной связи feedback_read имеет значение логического нуля.
